<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aplicar plantilla semanal</title>
  <style>
    :root{
      --fg:#222;
      --muted:#777;
      --line:#ddd;
      --bg:#f9f9f9;
      --blue:#0d6efd;
      --green:#198754;
      --red:#dc3545;
      --red-d:#b02a37;
      --card:#fff;
    }
    *{ box-sizing:border-box; }

    body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--fg); margin:0; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 1.3rem; margin: 0 0 16px; }
    .card { background:#fff; border:1px solid var(--line); border-radius:12px; padding:16px; margin-bottom:16px; }
    .row { display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
    label { font-weight:600; font-size:.9rem; }
    select,input[type="date"],input[type="text"]{
      padding:.45rem .55rem;
      border:1px solid var(--line);
      border-radius:8px;
      font-size:.9rem;
      background:#fff;
    }
    .muted { color: var(--muted); font-size: .85rem; }

    button{
      border:0;
      border-radius:10px;
      padding:.55rem .85rem;
      cursor:pointer;
      font-size:.9rem;
    }
    .btn-blue{ background:var(--blue); color:#fff; }
    .btn-blue:hover{ filter:brightness(.95); }

    /* ======================================================
       ‚úÖ MEN√ö LATERAL (IGUAL QUE PROGRAMACI√ìN)
       ====================================================== */

    .burger {
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 1101;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: #fff;
      cursor: pointer;
      font-size: 20px;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 4px rgba(0,0,0,.06);
    }
    .burger:hover { filter: brightness(.98); }
    .burger:focus-visible {
      outline: 2px solid var(--blue);
      outline-offset: 2px;
    }

    .nav-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.35);
      z-index: 1100;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease;
    }
    .nav-overlay.is-open {
      opacity: 1;
      pointer-events: auto;
    }

    .side-nav {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 300px;
      max-width: 84vw;
      background: var(--card);
      border-right: 1px solid var(--line);
      box-shadow: 0 8px 30px rgba(0,0,0,.14);
      z-index: 1102;

      transform: translateX(-105%);
      transition: transform .2s ease;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .side-nav.is-open { transform: translateX(0); }

    .side-nav__head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--line);
      margin-bottom: 6px;
    }
    .side-nav__brand {
      display: grid;
      line-height: 1.1;
    }
    .side-nav__brand strong { font-size: 1rem; }
    .side-nav__brand span { font-size: .78rem; color: var(--muted); }

    .side-nav__close {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: #fff;
      cursor: pointer;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .side-nav__close:hover { filter: brightness(.98); }

    .side-nav__link {
      text-decoration: none;
      color: var(--fg);
      padding: 10px 12px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: .92rem;
    }
    .side-nav__link:hover { background: #f3f3f3; }
  </style>
</head>

<body>
  <!-- ‚úÖ Bot√≥n hamburguesa -->
  <button class="burger" id="navToggle"
          aria-label="Abrir men√∫"
          aria-controls="sideNav"
          aria-expanded="false">‚ò∞</button>

  <!-- ‚úÖ Overlay -->
  <div class="nav-overlay" id="navOverlay" aria-hidden="true"></div>

  <!-- ‚úÖ Men√∫ lateral (solo Programaci√≥n y Plantillas) -->
  <nav class="side-nav" id="sideNav" aria-label="Men√∫ principal">
    <div class="side-nav__head">
      <div class="side-nav__brand">
        <strong>LuxSOP</strong>
        <span>ERP ¬∑ Limpieza</span>
      </div>
      <button class="side-nav__close" id="navClose" aria-label="Cerrar men√∫">‚úï</button>
    </div>

    <a class="side-nav__link" href="{{ url_for('main.home') }}">üè† Programaci√≥n</a>
    <a class="side-nav__link" href="{{ url_for('main.plantillas_panel') }}">üìã Plantillas</a>
  </nav>

  <div class="wrap">
    <h1>Aplicar plantilla semanal</h1>

    <div class="card">
      <form method="POST" action="{{ url_for('main.plantillas_aplicar_post') }}">
        <div class="row">
          <label for="lunes_destino">Semana destino:</label>
          <input type="date" id="lunes_destino" name="lunes_destino" value="{{ lunes_destino.strftime('%Y-%m-%d') }}">

          <label for="modo">Modo:</label>
          <select id="modo" name="modo">
            <option value="ruta_base">Ruta base</option>
            <option value="semana">Copiar semana</option>
            <option value="plantilla">Plantilla guardada</option>
          </select>

          <label style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" name="overwrite">
            Sobrescribir semana destino
          </label>
        </div>

        <div class="row" style="margin-top:12px;">
          <div id="block-semana" style="display:none;">
            <label for="lunes_origen">Semana origen:</label>
            <input type="date" id="lunes_origen" name="lunes_origen" value="{{ lunes_anterior.strftime('%Y-%m-%d') }}">
          </div>

          <div id="block-plantilla" style="display:none;">
            <label for="plantilla_id">Plantilla:</label>
            <select id="plantilla_id" name="plantilla_id">
              {% for p in plantillas %}
                <option value="{{ p.plantilla_id }}">{{ p.nombre }}</option>
              {% endfor %}
            </select>
          </div>

          <button class="btn-blue" type="submit">Aplicar</button>
        </div>

        <div class="muted" style="margin-top:10px;">
          Nota: si eliges ‚ÄúSobrescribir‚Äù, primero se borran tareas de la semana destino y luego se aplica.
        </div>
      </form>
    </div>
  </div>

  <script>
    // mostrar/ocultar bloques seg√∫n modo
    (function(){
      const modo = document.getElementById('modo');
      const bSemana = document.getElementById('block-semana');
      const bPlantilla = document.getElementById('block-plantilla');

      function sync(){
        const v = modo.value;
        bSemana.style.display = (v === 'semana') ? 'block' : 'none';
        bPlantilla.style.display = (v === 'plantilla') ? 'block' : 'none';
      }
      modo.addEventListener('change', sync);
      sync();
    })();

    // ‚úÖ Sidebar: abrir/cerrar + overlay + ESC + cerrar al navegar
    (function(){
      const nav = document.getElementById('sideNav');
      const btn = document.getElementById('navToggle');
      const closeBtn = document.getElementById('navClose');
      const overlay = document.getElementById('navOverlay');
      if(!nav || !btn || !overlay) return;

      function openNav(){
        nav.classList.add('is-open');
        overlay.classList.add('is-open');
        btn.setAttribute('aria-expanded','true');
        document.body.style.overflow = 'hidden';
      }
      function closeNav(){
        nav.classList.remove('is-open');
        overlay.classList.remove('is-open');
        btn.setAttribute('aria-expanded','false');
        document.body.style.overflow = '';
      }

      btn.addEventListener('click', openNav);
      overlay.addEventListener('click', closeNav);
      closeBtn && closeBtn.addEventListener('click', closeNav);

      document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape') closeNav();
      });

      nav.addEventListener('click', (e) => {
        const a = e.target.closest('a');
        if(a) closeNav();
      });
    })();
  </script>
</body>
</html>
